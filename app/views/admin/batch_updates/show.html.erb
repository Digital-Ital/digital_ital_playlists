<div class="container mx-auto px-6 py-10 bg-black/50 rounded-xl backdrop-blur-sm">
  <div class="mb-8">
    <h1 class="text-4xl font-bold text-white mb-2">📊 Batch Update Details</h1>
    <p class="text-gray-300">Detailed information about this batch update run</p>
  </div>

  <!-- Batch Info Cards -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
    <div class="bg-gradient-to-br from-blue-500/20 to-blue-600/20 rounded-xl p-6 border border-blue-500/30">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-blue-400 text-sm font-medium">Status</p>
          <p class="text-2xl font-bold text-white">
            <% case @batch_update.status %>
            <% when 'completed' %>
              ✅ Completed
            <% when 'running' %>
              🔄 Running
            <% when 'failed' %>
              ❌ Failed
            <% else %>
              ⏸️ <%= @batch_update.status&.titleize %>
            <% end %>
          </p>
        </div>
        <div class="w-12 h-12 bg-blue-500/20 rounded-full flex items-center justify-center">
          <span class="text-2xl">
            <% case @batch_update.status %>
            <% when 'completed' %>✅
            <% when 'running' %>🔄
            <% when 'failed' %>❌
            <% else %>⏸️
            <% end %>
          </span>
        </div>
      </div>
    </div>

    <div class="bg-gradient-to-br from-green-500/20 to-green-600/20 rounded-xl p-6 border border-green-500/30">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-green-400 text-sm font-medium">Changes Detected</p>
          <p class="text-2xl font-bold text-white"><%= @batch_update.changes_count || 0 %></p>
        </div>
        <div class="w-12 h-12 bg-green-500/20 rounded-full flex items-center justify-center">
          <span class="text-2xl">🔄</span>
        </div>
      </div>
    </div>

    <div class="bg-gradient-to-br from-purple-500/20 to-purple-600/20 rounded-xl p-6 border border-purple-500/30">
      <div class="flex items-center justify-between">
        <div>
          <p class="text-purple-400 text-sm font-medium">Duration</p>
          <p class="text-2xl font-bold text-white">
            <% if @duration %>
              <%= (@duration / 60).round(1) %>m
            <% else %>
              N/A
            <% end %>
          </p>
        </div>
        <div class="w-12 h-12 bg-purple-500/20 rounded-full flex items-center justify-center">
          <span class="text-2xl">⏱️</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Detailed Information -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    <!-- Timeline -->
    <div class="bg-gray-900/50 rounded-xl border border-gray-700 p-6">
      <h3 class="text-xl font-bold text-white mb-4">📅 Timeline</h3>
      <div class="space-y-4">
        <div class="flex items-center gap-3">
          <div class="w-3 h-3 bg-green-500 rounded-full"></div>
          <div>
            <p class="text-white font-medium">Started</p>
            <p class="text-gray-400 text-sm">
              <%= @batch_update.started_at&.strftime("%B %d, %Y at %H:%M:%S") %>
              (<%= time_ago_in_words(@batch_update.started_at) %> ago)
            </p>
          </div>
        </div>
        
        <% if @batch_update.completed_at %>
          <div class="flex items-center gap-3">
            <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
            <div>
              <p class="text-white font-medium">Completed</p>
              <p class="text-gray-400 text-sm">
                <%= @batch_update.completed_at.strftime("%B %d, %Y at %H:%M:%S") %>
                (<%= time_ago_in_words(@batch_update.completed_at) %> ago)
              </p>
            </div>
          </div>
        <% elsif @batch_update.status == 'running' %>
          <div class="flex items-center gap-3">
            <div class="w-3 h-3 bg-yellow-500 rounded-full animate-pulse"></div>
            <div>
              <p class="text-white font-medium">Currently Running</p>
              <p class="text-gray-400 text-sm">
                Started <%= time_ago_in_words(@batch_update.started_at) %> ago
              </p>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Progress -->
    <div class="bg-gray-900/50 rounded-xl border border-gray-700 p-6">
      <h3 class="text-xl font-bold text-white mb-4">📊 Progress</h3>
      <div class="space-y-4">
        <div>
          <div class="flex justify-between text-sm text-gray-400 mb-1">
            <span>Playlists Processed</span>
            <span><%= @batch_update.current_index || 0 %> / <%= @batch_update.total_count || 0 %></span>
          </div>
          <div class="w-full bg-gray-700 rounded-full h-2">
            <% if @batch_update.total_count && @batch_update.total_count > 0 %>
              <div class="bg-green-600 h-2 rounded-full" style="width: <%= ((@batch_update.current_index || 0).to_f / @batch_update.total_count * 100).round(1) %>%"></div>
            <% end %>
          </div>
        </div>
        
        <div class="grid grid-cols-2 gap-4 text-center">
          <div class="bg-gray-800/50 rounded-lg p-3">
            <p class="text-white font-bold text-lg"><%= @batch_update.current_index || 0 %></p>
            <p class="text-gray-400 text-sm">Processed</p>
          </div>
          <div class="bg-gray-800/50 rounded-lg p-3">
            <p class="text-white font-bold text-lg"><%= @batch_update.changes_count || 0 %></p>
            <p class="text-gray-400 text-sm">Changes</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Current Playlist -->
  <% if @batch_update.current_playlist_title.present? %>
    <div class="mt-8 bg-gray-900/50 rounded-xl border border-gray-700 p-6">
      <h3 class="text-xl font-bold text-white mb-4">🎵 Current Playlist</h3>
      <div class="flex items-center gap-3">
        <div class="w-3 h-3 bg-yellow-500 rounded-full animate-pulse"></div>
        <div>
          <p class="text-white font-medium"><%= @batch_update.current_playlist_title %></p>
          <p class="text-gray-400 text-sm">Currently being processed</p>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Error Information -->
  <% if @batch_update.status == 'failed' && @batch_update.error_message.present? %>
    <div class="mt-8 bg-red-900/20 rounded-xl border border-red-500/30 p-6">
      <h3 class="text-xl font-bold text-red-400 mb-4">❌ Error Details</h3>
      <div class="bg-gray-900/50 rounded-lg p-4">
        <pre class="text-red-300 text-sm whitespace-pre-wrap"><%= @batch_update.error_message %></pre>
      </div>
    </div>
  <% end %>

  <!-- Source Information -->
  <div class="mt-8 bg-gray-900/50 rounded-xl border border-gray-700 p-6">
    <h3 class="text-xl font-bold text-white mb-4">🔧 Source Information</h3>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div>
        <p class="text-gray-400 text-sm">Triggered By</p>
        <p class="text-white font-medium">
          <% if @batch_update.source == 'heroku_scheduler' %>
            🤖 Heroku Scheduler (Automated)
          <% else %>
            👤 Manual Trigger
          <% end %>
        </p>
      </div>
      <div>
        <p class="text-gray-400 text-sm">Batch ID</p>
        <p class="text-white font-medium font-mono"><%= @batch_update.id %></p>
      </div>
    </div>
  </div>

  <!-- Back Navigation -->
  <div class="mt-8 flex gap-4">
    <%= link_to "← Back to History", admin_batch_updates_path, 
        class: "inline-flex items-center px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-600 transition-colors" %>
    <%= link_to "Dashboard", admin_root_path, 
        class: "inline-flex items-center px-4 py-2 bg-green-700 text-white rounded-lg hover:bg-green-600 transition-colors" %>
  </div>
</div>
