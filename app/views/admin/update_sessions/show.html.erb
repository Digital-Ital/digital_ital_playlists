<div class="container mx-auto px-6 py-10 bg-black/50 rounded-xl backdrop-blur-sm">
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-2xl font-semibold text-white">Update Session Details</h1>
      <p class="text-gray-400 text-sm mt-1">
        <%= @update_session.created_at.strftime("%B %d, %Y at %I:%M %p") %>
      </p>
    </div>
    <div class="space-x-2">
      <%= link_to 'Back to Sessions', admin_update_sessions_path, class: 'px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-500 transition-colors' %>
      <% if @update_session.status == 'completed' && @update_session.playlist_updates.pending.any? %>
        <%= link_to 'Apply Changes', apply_changes_admin_update_session_path(@update_session), 
                    class: 'px-4 py-2 bg-green-500 text-black rounded-lg hover:bg-green-400 transition-colors' %>
      <% end %>
    </div>
  </div>

  <!-- Session Stats -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
    <div class="bg-gray-900/80 rounded-xl p-4 border border-gray-700">
      <div class="text-2xl font-bold text-white"><%= @update_session.total_playlists %></div>
      <div class="text-gray-400 text-sm">Total Playlists</div>
    </div>
    <div class="bg-gray-900/80 rounded-xl p-4 border border-gray-700">
      <div class="text-2xl font-bold text-white"><%= @update_session.updated_playlists || 0 %></div>
      <div class="text-gray-400 text-sm">Updated Playlists</div>
    </div>
    <div class="bg-gray-900/80 rounded-xl p-4 border border-gray-700">
      <div class="text-2xl font-bold text-white"><%= @update_session.success_rate %>%</div>
      <div class="text-gray-400 text-sm">Success Rate</div>
    </div>
    <div class="bg-gray-900/80 rounded-xl p-4 border border-gray-700">
      <div class="text-2xl font-bold text-white">
        <%= @update_session.duration ? "#{@update_session.duration.round(1)}s" : '-' %>
      </div>
      <div class="text-gray-400 text-sm">Duration</div>
    </div>
  </div>

  <!-- Status -->
  <div class="bg-gray-900/80 rounded-xl p-6 border border-gray-700 mb-8">
    <div class="flex items-center justify-between">
      <div>
        <h3 class="text-lg font-semibold text-white">Session Status</h3>
        <p class="text-gray-400">
          <% case @update_session.status %>
          <% when 'running' %>
            🔄 Currently checking playlists for updates...
          <% when 'completed' %>
            ✅ Update check completed successfully
          <% when 'failed' %>
            ❌ Update check failed
          <% end %>
        </p>
      </div>
      <span class="px-3 py-1 rounded-full text-sm font-semibold
        <%= case @update_session.status
            when 'completed' then 'bg-green-600 text-white'
            when 'running' then 'bg-yellow-600 text-black'
            when 'failed' then 'bg-red-600 text-white'
            else 'bg-gray-600 text-white'
            end %>">
        <%= @update_session.status.titleize %>
      </span>
    </div>
  </div>

  <!-- Changes Found -->
  <% if @playlist_updates.any? %>
    <div class="bg-gray-900/80 rounded-xl p-6 border border-gray-700">
      <h3 class="text-lg font-semibold text-white mb-4">
        Changes Found (<%= @playlist_updates.count %>)
      </h3>
      
      <% @updates_by_playlist.each do |playlist, updates| %>
        <div class="bg-gray-800/50 rounded-lg p-4 mb-4 border border-gray-600">
          <div class="flex items-center justify-between mb-3">
            <h4 class="text-white font-semibold">
              <%= link_to playlist.title, admin_playlist_path(playlist), 
                          class: 'hover:text-yellow-400 transition-colors' %>
            </h4>
            <span class="text-gray-400 text-sm">
              <%= updates.count %> change<%= 's' if updates.count != 1 %>
            </span>
          </div>
          
          <div class="space-y-2">
            <% updates.each do |update| %>
              <div class="flex items-center justify-between bg-gray-700/50 rounded p-3">
                <div class="flex-1">
                  <div class="text-sm text-gray-300 mb-1">
                    <span class="font-medium"><%= update.field_name.humanize %>:</span>
                    <%= update.display_change %>
                  </div>
                  <div class="text-xs text-gray-400">
                    Status: 
                    <span class="px-1 py-0.5 rounded text-xs
                      <%= case update.status
                          when 'pending' then 'bg-yellow-600 text-black'
                          when 'confirmed' then 'bg-blue-600 text-white'
                          when 'applied' then 'bg-green-600 text-white'
                          when 'rejected' then 'bg-red-600 text-white'
                          end %>">
                      <%= update.status.titleize %>
                    </span>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="bg-gray-900/80 rounded-xl p-6 border border-gray-700 text-center">
      <div class="text-4xl mb-4">✅</div>
      <h3 class="text-lg font-semibold text-white mb-2">No Changes Found</h3>
      <p class="text-gray-400">All playlists are up to date with their Spotify counterparts.</p>
    </div>
  <% end %>
</div>
